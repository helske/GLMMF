convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-5,maxapp=15,gradient=TRUE,
check.analyticals=FALSE,print.level=2,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=8000,gradtol=1e-2,steptol=1e-3,iterlim=15)
proc.time()-a
746/60
fit_glmmf2$logLik
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-5,maxapp=15,gradient=TRUE,
check.analyticals=FALSE,print.level=2,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=8000,gradtol=1e-2,steptol=1e-3,iterlim=15)
proc.time()-a
library(GLMMF)
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-5,maxapp=15,gradient=TRUE,
check.analyticals=FALSE,print.level=2,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=8000,gradtol=1e-2,steptol=1e-3,iterlim=15)
proc.time()-a
747/60
fit_glmmf2$logLik
debug(GLMMF:::fitGLMMF2)
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-5,maxapp=15,gradient=TRUE,
check.analyticals=FALSE,print.level=1,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=8000,gradtol=1e-2,steptol=1e-3,iterlim=25)
proc.time()-a
llold
ll<-10*llold
llold<-ll
approx.model<-approxG(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace)
amodel$u[]<-approx.model$H
amodel$y[]<-approx.model$y
fit<-nlm(p=inits,f=likfn,model=amodel,estimate=TRUE,...)
amodel2<-model
amodel<-likfn(fit$e,amodel,FALSE)
amodel$Z[,,1]
model<-likfn(fit$e,model,FALSE)
ll<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,1)$logLik
ll
llold<-ll
approx.model<-approxG(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace)
amodel$u[]<-approx.model$H
amodel$y[]<-approx.model$y
amodel$Z[,,1]
fit<-nlm(p=inits,f=likfn,model=amodel,estimate=TRUE,...)
model<-likfn(fit$e,model,FALSE)
ll<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,1)$logLik
print(paste("Iter",ii,"log-likelihood",ll))
ii<-2
print(paste("Iter",ii,"log-likelihood",ll))
llold<-ll
approx.model<-approxG(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace)
approx.model$conv
amodel$u[]<-approx.model$H
amodel$y[]<-approx.model$y
amodel$Z[]<-model$Z
fit<-nlm(p=inits,f=likfn,model=amodel,estimate=TRUE,...)
model<-likfn(fit$e,model,FALSE)
ll<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,1)$logLik
print(paste("Iter",ii,"log-likelihood",ll))
fit$e
ll
amodel2<-amodel
amodel$Z[,,1]-model$Z[,,1]
model$Z[]<-amodel$Z[]
expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,1)$logLik
maxiter
theta
model2<-model
fit<-nlm(p=inits,f=likfn,model=amodel,estimate=TRUE,...)
out<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,2,1)
dist
out$logLik
ll
ll<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,0)$logLik
ll
llold<-ll
approx.model<-approxG(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace)
amodel$u[]<-approx.model$H
amodel$y[]<-approx.model$y
amodel$Z[]<-model$Z
approx.model
ll
fit<-nlm(p=inits,f=likfn,model=amodel,estimate=TRUE,...)
model3<-model
model<-likfn(fit$e,model,FALSE)
ll<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,0)$logLik
ll
out<-<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,0)
out<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,0)
out$log
out$conv
out<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,2,0)
model3$Z[,,1]
model$Z[,,1]
fit$e
fit
approx.model<-approxG(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace)
amodel$u[]<-approx.model$H
amodel$y[]<-approx.model$y
amodel$Z[]<-model$Z
fit<-nlm(p=inits,f=likfn,model=amodel,estimate=TRUE,...)
amodel<-likfn(fit$e,amodel,FALSE)
model<-likfn(fit$e,model,FALSE)
ll<-expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,0)$logLik
ll
print(paste("Iter",ii,"log-likelihood",ll))
llold<-ll
approx.model<-approxG(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace)
approx.model$conv
amodel$u[]<-approx.model$H
amodel$y[]<-approx.model$y
fit2<-fit
model2<-model
fit<-nlm(p=inits,f=likfn,model=amodel,estimate=TRUE,...)
amodel<-likfn(fit$e,amodel,FALSE)
model<-likfn(fit$e,model,FALSE)
expfLogLikNoSim(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace,0)$logLik
approx.model<-approxG(model$y, model$Z, model$u, model$a1, model$P1, model$P1inf,
dist, model$tol, maxiter, maxiter2, convtol, theta, model$Zind, model$nfactors,trace)
amodel$u[]<-approx.model$H
amodel$y[]<-approx.model$y
fit<-nlm(p=inits,f=likfn,model=amodel,estimate=TRUE,...)
model$Z[,,1]
fit$e
fit2$e
fit
fit2
names(approx.model)
theta
approx.model$theta
Q
library(GLMMF)
debug(GLMMF:::fitGLMMF2)
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-5,maxapp=15,gradient=TRUE,
check.analyticals=FALSE,print.level=1,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=8000,gradtol=1e-2,steptol=1e-3,iterlim=25)
proc.time()-a
inits
fit$e
theta
approx.model$conv
gradtol
amodel$u[]
approx.model$H
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-5,maxapp=15,gradient=TRUE,
check.analyticals=FALSE,print.level=1,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=8000,iterlim=25)
proc.time()-a
#-7487.03431060908
#
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=500)
proc.time()-a
#-7303.66449702379
#
library(GLMMF)
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=500)
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=1,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
proc.time()-a
#-7303.66449702379
#
#
a<-proc.time()
fit_glmmf3<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=500)
proc.time()-a
#-7303.66449702379
#
1300/60
fit_glmmf2$logLik
fit_glmmf3$logLik
fit10a<-fit_glmmf3
save(fit10a,file="fit10approx.rda")
load("fit.rda")
fit_glmmf1$logLik
fit_glmmf2$logLik
fit_glmmf3$logLik
load("fit10approx.rda")
factors<-fit10a$coefs[1:2,]
dat = read.csv("born.csv")
X = dat[,1:4] #remove id column
plot(x=factors[1,],y=factors[2,],type="n",main="LV + intercept",xlab="LV1",ylab="LV2")
points(x=factors[1,],y=factors[2,],col=as.numeric(X[,2]),pch=as.numeric(X[,3]))
legend("topleft", c("P","L89","L93","L","M","U"),col=c(3,1,2,1,1,1),pch=c(15,15,15,1,2,3))
legend("bottomright", c("P","L89","L93","L","M","U"),col=c(3,1,2,1,1,1),pch=c(15,15,15,1,2,3))
factors<-fit10a$coefs[1:2,]
dat = read.csv("born.csv")
X = dat[,1:4] #remove id column
plot(x=factors[1,],y=factors[2,],type="n",main="LV + intercept",xlab="LV1",ylab="LV2")
points(x=factors[1,],y=factors[2,],col=as.numeric(X[,2]),pch=as.numeric(X[,3]))
legend("bottomright", c("P","L89","L93","L","M","U"),col=c(3,1,2,1,1,1),pch=c(15,15,15,1,2,3))
library(hht)
install.packages("hht")
library(hht)
?hht
?EEMD
?CEEMD
data(PortFosterEvent)
noise.amp <- 6.4e-07
trials <- 100
ceemd.result <- CEEMD(sig, tt, noise.amp, trials)
for(i in 1:100) ceemd.result <- CEEMD(sig, tt, noise.amp, trials,verbose=FALSE)
library(GLMMF)
library(StateSpaceGLMM)
library(nloptr)
library(KFAS)
library(numDeriv)
dat = read.csv("../GLMMF/born.csv")
Y = dat[,-(1:4)]
X = dat[,2:4] #remove id column
#remove rare species:
Y = as.matrix(Y[,apply(Y>0,2,sum)>10])
Xdat<-do.call(rbind, replicate(ncol(Y), X, simplify=FALSE)) # 5069  3
species<-rep(colnames(Y),each=nrow(Y))
borneodata<-data.frame(c(Y),Xdat,species)
names(borneodata)<-c("abundance",colnames(Xdat),"species")
set.seed(12345)
randu1<-rnorm(37)
randu2<-rnorm(37)
fitinit_glmmf<-glmmf(group="species",response="abundance",distinct=~randu1+randu2,
nfactors=0,distribution="poisson",maxiter=100,
data=borneodata,control=list(trace=1,REPORT=1),method="BFGS",trace=2,estimate=F)
fitinit_glmmf$log #-1561.845
initmat_glmmf<-t(matrix(fitinit_glmmf$coefs[,37],nrow=3)[2:3,])
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=F,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
proc.time()-a
fit_glmmf2<-glmmf(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=F,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
model<-fit_glmmf2
approxH
approxG
GLMMF:::approxG
initTheta
init_theta
GLMMF:::init_theta
amodel<-approxG(model$y,model$Z,model$u,model$P1,model$P1inf,2,model$tol,100,10,1e-8,GLMMF:::init_theta(model$y,model$u,"poisson"),model$Zind,2,2)
amodel<-GLMMF:::approxG(model$y,model$Z,model$u,model$P1,model$P1inf,2,model$tol,100,10,1e-8,GLMMF:::init_theta(model$y,model$u,"poisson"),model$Zind,2,2)
amodel<-GLMMF:::approxG(model$y,model$Z,model$u,model$a1,model$P1,model$P1inf,2,model$tol,100,10,1e-8,GLMMF:::init_theta(model$y,model$u,"poisson"),
model$Zind,2,2)
GLMMF:::init_theta(model$y,model$u,"poisson")
GLMMF:::init_theta(model$y,model$u,"poisson")
model$y
model<-fit_glmmf$model
model<-fit_glmmf2$model
model$y
amodel<-GLMMF:::approxG(model$y,model$Z,model$u,model$a1,model$P1,model$P1inf,2,model$tol,100,10,1e-8,GLMMF:::init_theta(model$y,model$u,"poisson"),
model$Zind,2,2)
amodel$y
dim(amodel$y)
amodel$theta
res<-amodel$y-amodel$theta
ts.plot(res)
plot(res)
hist(res)
factanal(res,2)
factanal(res[1,],2)
res[1,]
factanal(res[1,,drop=FALSE],2)
res[1,,drop=FALSE]
amodel$H[,,1]
amodel$H[1,]
factanal(res[1,,drop=FALSE],2,covmat=diag(amodel$H[1,]))
res[1,,drop=FALSE]
diag(amodel$H[1,])
mean(res[1,,drop=FALSE])
var(res[1,,drop=FALSE])
factanal(res,2,covmat=diag(amodel$H[1,]))
res
summary(c(res))
cor(res)
factanal(res,2)
solve(cov(res))
factanal(t(res),2)
dim(t(res))
factanal(t(res),2,covmat=diag(amodel$H[1,]))
names(factanal(t(res),2))
factanal(t(res),2)$loadings
as.matrix(factanal(t(res),2)$loadings)
names(factanal(t(res),2)$loadings)
print(factanal(t(res),2)$loadings)
print(factanal(t(res),2)$loadings,cutoff=0)
matrix(print(factanal(t(res),2)$loadings,cutoff=0))
matrix(factanal(t(res),2)$loadings)
matrix(factanal(t(res),2)$loadings,ncol=2)
print(factanal(t(res),2)$loadings,cutoff=0)
matrix(factanal(t(res),2)$loadings,ncol=2)
initmat<-matrix(factanal(t(res),2)$loadings,ncol=2)
fit_glmmf3<-glmmf3(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat,
data=borneodata, estimate=F,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
fit_glmmf3<-glmmf(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat,
data=borneodata, estimate=F,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
dim(initmat)
factanal(t(res),2)
factanal(res,2)
a<-proc.time()
fit1<-glmmf(group="species",response="abundance",distinct=~1,nfactors=0,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat,
data=borneodata, estimate=F,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
proc.time()-a
amodel<-GLMMF:::approxG(model$y,model$Z,model$u,model$a1,model$P1,model$P1inf,2,model$tol,100,10,1e-8,GLMMF:::init_theta(model$y,model$u,"poisson"),
model$Zind,0,2)
dim(amodel$y) #37 96
dim(amodel$P1)
amodel$P1
dim(model$P1)
model<-fit1$model
dim(model$P1)
amodel<-GLMMF:::approxG(model$y,model$Z,model$u,model$a1,model$P1,model$P1inf,2,model$tol,100,10,1e-8,GLMMF:::init_theta(model$y,model$u,"poisson"),
model$Zind,0,2)
dim(amodel$y) #37 96
res<-amodel$y-amodel$theta
factanal(res,2)
amodel$theta
res
solve(cov(res)
)
diag(cov(res))
cor(res))
cor(res)
dim(res)
factanal(res[,-1],2)
factanal(model$y,2)
factanal(res[1,],2)
factanal(res[1,,drop=F],2)
factanal(res[1:2,,drop=F],2)
load("fit10approx.rda")
factors<-fit10a$coefs[1:2,]
dat = read.csv("born.csv")
X = dat[,1:4] #remove id column
plot(x=factors[1,],y=factors[2,],type="n",main="LV + intercept",xlab="LV1",ylab="LV2")
points(x=factors[1,],y=factors[2,],col=as.numeric(X[,2]),pch=as.numeric(X[,3]))
legend("bottomright", c("P","L89","L93","L","M","U"),col=c(3,1,2,1,1,1),pch=c(15,15,15,1,2,3))
fit10a$model$Z
fit10a$model$Z[2:3,,1]
t(fit10a$model$Z[1:2,,1])
library(GLMMF)
library(StateSpaceGLMM)
library(nloptr)
library(KFAS)
library(numDeriv)
dat = read.csv("../GLMMF/born.csv")
Y = dat[,-(1:4)]
X = dat[,2:4] #remove id column
#remove rare species:
Y = as.matrix(Y[,apply(Y>0,2,sum)>10])
Xdat<-do.call(rbind, replicate(ncol(Y), X, simplify=FALSE)) # 5069  3
species<-rep(colnames(Y),each=nrow(Y))
borneodata<-data.frame(c(Y),Xdat,species)
names(borneodata)<-c("abundance",colnames(Xdat),"species")
set.seed(12345)
randu1<-rnorm(37)
randu2<-rnorm(37)
fitinit_glmmf<-glmmf(group="species",response="abundance",distinct=~randu1+randu2,
nfactors=0,distribution="poisson",maxiter=100,
data=borneodata,control=list(trace=1,REPORT=1),method="BFGS",trace=2,estimate=F)
fitinit_glmmf$log #-1561.845
initmat_glmmf<-t(matrix(fitinit_glmmf$coefs[,37],nrow=3)[2:3,])
library(lme4)
Xdat
str(Xdat)
names(borneodata)
library(GLMMF)
library(nloptr)
library(KFAS)
library(numDeriv)
dat = read.csv("../GLMMF/born.csv")
Y = dat[,-(1:4)]
X = dat[,2:4] #remove id column
#remove rare species:
Y = as.matrix(Y[,apply(Y>0,2,sum)>30])
Xdat<-do.call(rbind, replicate(ncol(Y), X, simplify=FALSE)) # 5069  3
species<-rep(colnames(Y),each=nrow(Y))
borneodata<-data.frame(c(Y),Xdat,species)
names(borneodata)<-c("abundance",colnames(Xdat),"species")
set.seed(12345)
randu1<-rnorm(37)
randu2<-rnorm(37)
library(StateSpaceGLMM)
fitinit_glmmf<-glmmf(group="species",response="abundance",distinct=~randu1+randu2,
nfactors=0,distribution="poisson",maxiter=100,
data=borneodata,control=list(trace=1,REPORT=1),method="BFGS",trace=2,estimate=F)
fitinit_glmmf$log #-1561.845
initmat_glmmf<-t(matrix(fitinit_glmmf$coefs[,37],nrow=3)[2:3,])
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
a<-proc.time()
fit_glmmf3<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=500)
proc.time()-a
rm(list=ls())
library(GLMMF)
dat = read.csv("../GLMMF/born.csv")
Y = dat[,-(1:4)]
X = dat[,2:4] #remove id column
#remove rare species:
Y = as.matrix(Y[,apply(Y>0,2,sum)>30])
Xdat<-do.call(rbind, replicate(ncol(Y), X, simplify=FALSE)) # 5069  3
species<-rep(colnames(Y),each=nrow(Y))
borneodata<-data.frame(c(Y),Xdat,species)
names(borneodata)<-c("abundance",colnames(Xdat),"species")
set.seed(12345)
randu1<-rnorm(37)
randu2<-rnorm(37)
fitinit_glmmf<-glmmf(group="species",response="abundance",distinct=~randu1+randu2,
nfactors=0,distribution="poisson",maxiter=100,
data=borneodata,control=list(trace=1,REPORT=1),method="BFGS",trace=2,estimate=F)
fitinit_glmmf$log #-1561.845
initmat_glmmf<-t(matrix(fitinit_glmmf$coefs[,37],nrow=3)[2:3,])
a<-proc.time()
fit_glmmf2<-glmmf2(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
proc.time()-a
fit_glmmf2b<-glmmf(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8,maxapp=100,gradient=TRUE,
check.analyticals=FALSE,print.level=0,typsize=rep(0,sum(lower.tri(initmat_glmmf,TRUE))),
fscale=7000,iterlim=50)
fit_glmmf2b<-glmmf(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T,trace=1,epsilon=1e-8)
fit_glmmf2b<-glmmf(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=100,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T)
fit_glmmf2b
fit_glmmf2b$fit$value
fit_glmmf2$fit$value
fit_glmmf2
names(fit_glmmf2)
fit_glmmf2$coefs-fit_glmmf2b$coefs
logLik
logLik(fit_glmmf2)
names(fit_glmmf2)
logLik(fit_glmmf2)
fit_glmmf2$logLik
fit_glmmf2b$logLik
fit_glmmf2b<-glmmf(group="species",response="abundance",distinct=~1,nfactors=2,distribution="poisson",
convtol=1e-8,maxiter=1000,maxiter2=5,init.factor=initmat_glmmf,
data=borneodata, estimate=T)
